<!--==============================
	Footer Area
==============================-->
<footer class="footer-wrapper footer-layout-default" data-bg-src="<?= base_url('assets'); ?>/img/bg/footer-bg.png">
    <div class="shape-mockup footer-shape1 jump" data-left="60px" data-top="70px">
        <img src="<?= base_url('assets'); ?>/img/normal/footer-bg-shape1.png" alt="img">
    </div>
    <div class="shape-mockup footer-shape2 jump-reverse" data-right="80px" data-bottom="120px">
        <img src="<?= base_url('assets'); ?>/img/normal/footer-bg-shape2.png" alt="img">
    </div>
    <div class="footer-top">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-3">
                    <div class="footer-logo">
                        <a href="/"><img src="<?= base_url('assets'); ?>/img/logo-white.svg" alt="SPK"></a>
                    </div>
                </div>
                <div class="col-lg-9">
                    <div class="newsletter-wrap">
                        <h5 class="newsletter-title">Ikuti Informasi Terbaru Serikat Pekerja Kampus</h5>
                        <form action="<?= base_url('welcome/subscribe'); ?>" method="post" class="newsletter-form">
                            <div class="form-group">
                                <input type="text" class="form-control" id="email" name="email" placeholder="Masukkan Email Anda">
                                <i class="far fa-envelope"></i>
                            </div>
                            <button type="submit" class="th-btn style3">Ikuti Sekarang<i class="fas fa-arrow-right ms-2"></i></button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="widget-area">
        <div class="container">
            <div class="row justify-content-between">
                <div class="col-md-6 col-xxl-3 col-xl-3">
                    <div class="widget footer-widget">
                        <div class="th-widget-about">
                            <h3 class="widget_title">Serikat Pekerja Kampus</h3>
                            <p class="about-text">Serikat Pekerja Kampus adalah Serikat pekerja yang mewadahi para pekerja di bidang/sektor pendidikan tinggi</p>
                            <div class="th-social">
                                <h6 class="title text-white">IKUTI KAMI:</h6>
                                <a href="https://www.facebook.com/pekerjakampus"><i class="fab fa-facebook-f"></i></a>
                                <a href="https://www.twitter.com/pekerjakampus"><i class="fab fa-twitter"></i></a>
                                <a href="https://www.youtube.com/@SerikatPekerjaKampus"><i class="fab fa-youtube"></i></i></a>
                                <a href="https://www.linkedin.com/company/serikat-pekerja-kampus/"><i class="fab fa-linkedin-in"></i></a>
                                <a href="https://www.instagram.com/serikatpekerjakampus"><i class="fab fa-instagram"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-xl-auto">
                    <div class="widget widget_nav_menu footer-widget">
                        <h3 class="widget_title">Laman Kami</h3>
                        <div class="menu-all-pages-container">
                            <ul class="menu">
                                <li><a href="about">Tentang Kami</a></li>
                                <li><a href="sejarah">Sejarah</a></li>
                                <li><a href="visimisi">Visi & Misi</a></li>
                                <li><a href="manifesto">Manifesto</a></li>
                                <li><a href="adart">AD/ART</a></li>
                                <!--<li><a href="pengurus">Pengurus SPK</a></li>-->
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-xl-auto">
                    <div class="widget widget_nav_menu footer-widget">
                        <h3 class="widget_title">Publikasi</h3>
                        <div class="menu-all-pages-container">
                            <ul class="menu">
                                <li><a href="publikasi">Publikasi SPK</a></li>
                                <li><a href="regulasi">Regulasi Pemerintah</a></li>
                                <li><a href="post">Tulisan Anggota</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-xl-auto">
                    <div class="widget widget_nav_menu footer-widget">
                        <h3 class="widget_title">Pranala Luar</h3>
                        <div class="menu-all-pages-container">
                            <ul class="menu">
                                <li><a href="https://www.kemdikbud.go.id/">Kemendikbud</a></li>
                                <li><a href="https://www.instagram.com/kebebasanakademik/?hl=en">KIKA</a></li>
                                <li><a href="https://www.bkn.go.id/">BKN</a></li>
                                <li><a href="https://www.dpr.go.id/akd/index/id/Tentang-Komisi-IX">Komisi IX DPR RI</a></li>
                                <li><a href="https://www.dpr.go.id/akd/index/id/Tentang-Komisi-X">Komisi X DPR RI</a></li>

                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-xxl-3 col-xl-3">
                    <div class="widget widget_contact footer-widget">
                        <h3 class="widget_title">Alamat Serikat</h3>
                        <p class="contact-text">Kami terbuka untuk melayani informasi dan pengaduan mengenai Serikat Pekerja Kampus.</p>
                        <div class="th-widget-contact">
                            <div class="info-box-wrap">
                                <div class="info-box_icon">
                                    <i class="fas fa-location-dot"></i>
                                </div>
                                <p class="info-box_text">
                                    <a href="https://maps.app.goo.gl/4GVtpfsHnNSSAMGSA" target="_blank" class="contact-feature_link">Jl. D No.21, RT.3/RW.2, Tegal Parang, Kec. Mampang Prpt., Kota Jakarta Selatan,<br> Daerah Khusus Ibukota Jakarta 12790</a>
                                </p>
                            </div>
                            <div class="info-box-wrap">
                                <div class="info-box_icon">
                                    <i class="fas fa-envelope"></i>
                                </div>
                                <a href="mailto:sekretariat@spk.or.id" class="info-box_link">sekretariat@spk.or.id</a>
                            </div>
                            <div class="info-box-wrap">
                                <div class="info-box_icon">
                                    <i class="fas fa-phone"></i>
                                </div>
                                <!--<a href="https://api.whatsapp.com/send?phone=6287819531788&text=Salam%20perjuangan!" class="info-box_link">+62 8781 9531 788</a>-->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="copyright-wrap">
        <div class="container">
            <div class="row justify-content-between align-items-center">
                <div class="col-md-6">
                    <p class="copyright-text">Copyright Â© <?= date('Y'); ?> <a href="/">Serikat Pekerja Kampus</a> All Rights Reserved.</p>
                </div>
                <div class="col-md-6 text-end d-none d-md-block">
                    <div class="footer-links">
                        <ul>
                            <li><a href="publikasi">Brief Policy</a></li>
                            <li><a href="regulasi">Terms & Condition</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>

<!--********************************
			Code End  Here 
	******************************** -->

<!-- Scroll To Top -->
<div class="scroll-top">
    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"
            style="transition: stroke-dashoffset 10ms linear 0s; stroke-dasharray: 307.919, 307.919; stroke-dashoffset: 307.919;"></path>
    </svg>
</div>

<!--==============================
    All Js File
============================== -->
<script src="<?= base_url('assets'); ?>/js/vendor/jquery-3.6.0.min.js"></script>
<script src="<?= base_url('assets'); ?>/js/slick.min.js"></script>
<script src="<?= base_url('assets'); ?>/js/bootstrap.min.js"></script>
<script src="<?= base_url('assets'); ?>/js/jquery.magnific-popup.min.js"></script>
<script src="<?= base_url('assets'); ?>/js/jquery.counterup.min.js"></script>
<script src="<?= base_url('assets'); ?>/js/circle-progress.js"></script>
<script src="<?= base_url('assets'); ?>/js/jquery-ui.min.js"></script>
<script src="<?= base_url('assets'); ?>/js/imagesloaded.pkgd.min.js"></script>
<script src="<?= base_url('assets'); ?>/js/isotope.pkgd.min.js"></script>
<script src="<?= base_url('assets'); ?>/js/tilt.jquery.min.js"></script>
<script src="<?= base_url('assets'); ?>/js/tweenmax.min.js"></script>
<script src="<?= base_url('assets'); ?>/js/nice-select.min.js"></script>
<script src="<?= base_url('assets'); ?>/js/main.js"></script>

<!-- External Libraries -->
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Highcharts Maps CDN -->
<script src="https://code.highcharts.com/maps/highmaps.js"></script>
<script src="https://code.highcharts.com/maps/modules/exporting.js"></script>
<script src="https://code.highcharts.com/mapdata/countries/id/id-all.js"></script>

<script>
    var provinsiData = <?= json_encode($per_provinsi) ?>;
</script>


<!-- Script Modal -->
<script>
    window.addEventListener('load', function() {
        setTimeout(function() {
            const modal = document.getElementById('popupModal');
            if (modal) modal.style.display = 'flex';
        }, 1000);
    });

    document.getElementById('closeModal')?.addEventListener('click', function() {
        const modal = document.getElementById('popupModal');
        if (modal) modal.style.display = 'none';
    });
</script>

<!-- Script Select2 & Currency Calculator -->
<script>
    $(document).ready(function() {
        const $jenisPtDropdown = $('#id_jenis_pt');
        const $kampusDropdown = $('#id_kampus');

        $kampusDropdown.select2({
            placeholder: 'Ketik untuk mencari nama kampus...',
            theme: 'bootstrap-5',
            ajax: {
                url: "<?= site_url('welcome/get_kampus_ajax'); ?>",
                dataType: 'json',
                delay: 250,
                data: function(params) {
                    return {
                        q: params.term,
                        id_jenis_pt: $jenisPtDropdown.val()
                    };
                },
                processResults: function(data) {
                    return {
                        results: data.results
                    };
                },
                cache: true
            },
            minimumInputLength: 1
        });

        $jenisPtDropdown.on('change', function() {
            const jenisPtId = $(this).val();
            $kampusDropdown.val(null).trigger('change');
            if (jenisPtId) {
                $kampusDropdown.prop('disabled', false);
            } else {
                $kampusDropdown.prop('disabled', true);
                $kampusDropdown.html('<option value="">-- Pilih Jenis PT Dahulu --</option>');
            }
        });

        if ($jenisPtDropdown.val()) {
            $kampusDropdown.prop('disabled', false);
        }
    });

    // Currency helper functions
    function sanitizeJsCurrency(value) {
        if (value === null || typeof value === 'undefined' || String(value).trim() === '') return 0;
        let cleaned = String(value).replace(/Rp\s*/gi, '').replace(/\./g, '').replace(/,/g, '.');
        const num = parseFloat(cleaned);
        return isNaN(num) ? 0 : num;
    }

    function formatCurrencyForDisplay(number) {
        return number.toLocaleString('id-ID', {
            minimumFractionDigits: 0,
            maximumFractionDigits: 2
        });
    }

    function calculateTotals() {
        let totalBruto = 0,
            totalPotongan = 0;
        totalBruto += sanitizeJsCurrency($('#gaji_pokok').val());
        totalBruto += sanitizeJsCurrency($('#tunjangan_jabatan').val());
        totalBruto += sanitizeJsCurrency($('#tunjangan_fungsional').val());
        totalBruto += sanitizeJsCurrency($('#tunjangan_makan').val());
        totalBruto += sanitizeJsCurrency($('#tunjangan_transport').val());
        totalBruto += sanitizeJsCurrency($('#tunjangan_lainnya').val());
        totalPotongan += sanitizeJsCurrency($('#pot_pph21').val());
        totalPotongan += sanitizeJsCurrency($('#pot_bpjs_tk').val());
        totalPotongan += sanitizeJsCurrency($('#pot_bpjs_kesehatan').val());
        totalPotongan += sanitizeJsCurrency($('#potongan_lainnya').val());
        const thp = totalBruto - totalPotongan;
        $('#total_penghasilan_bruto').val(formatCurrencyForDisplay(totalBruto));
        $('#total_potongan').val(formatCurrencyForDisplay(totalPotongan));
        $('#thp').val(formatCurrencyForDisplay(thp));
    }

    $('.numeric-input').on('input', function(e) {
        calculateTotals();
    });
    calculateTotals();

    // DataTable untuk tabel kampus
    $(document).ready(function() {
        $('#tabel-statistik-kampus').DataTable({
            pageLength: 10,
            order: [
                [0, 'asc']
            ]
        });
    });
</script>

<!-- Visualisasi Chart -->
<script>
    function formatRupiah(val) {
        return "Rp" + (val ? val.toLocaleString('id-ID') : "0");
    }
    // Ambil data dari PHP
    var distribusiUpahBinned = <?= json_encode($distribusi_upah_binned) ?>;
    var distribusiUsiaBinned = <?= json_encode($distribusi_usia_binned) ?>;
    var upahPerGender = <?= json_encode($upah_per_gender) ?>;
    var upahDosenTendik = <?= json_encode($upah_dosen_vs_tendik) ?>;
    var upahPerPendidikan = <?= json_encode($upah_per_pendidikan) ?>;
    var upahPerKepegawaian = <?= json_encode($upah_per_kepegawaian) ?>;
    var statistikGender = <?= json_encode($statistik_gender) ?>;
    var statistikPendidikan = <?= json_encode($statistik_pendidikan) ?>;
    var perProvinsi = <?= json_encode($per_provinsi) ?>;
    var upahPerProvinsiGender = <?= json_encode($upah_per_provinsi_gender) ?>;
    var distribusiLamaBekerjaBinned = <?= json_encode($distribusi_lama_bekerja_binned) ?>;
    var upahPerJenisPT = <?= json_encode($upah_per_jenis_pt) ?>;
    var upahPerLamaBekerja = <?= json_encode($upah_per_lama_bekerja) ?>;

    // Histogram Upah
    new ApexCharts(document.querySelector("#chart-distribusi-upah"), {
        chart: {
            type: 'bar',
            height: 340
        },
        series: [{
            name: "Responden",
            data: distribusiUpahBinned.series
        }],
        xaxis: {
            categories: distribusiUpahBinned.labels,
            labels: {
                rotate: -60,
                trim: true
            }
        },
        yaxis: {
            title: {
                text: "Jumlah Responden"
            }
        },
        tooltip: {
            y: {
                formatter: function(val) {
                    return val + " responden";
                }
            }
        }
    }).render();

    // Histogram Usia
    new ApexCharts(document.querySelector("#chart-distribusi-usia"), {
        chart: {
            type: 'bar',
            height: 340
        },
        series: [{
            name: "Responden",
            data: distribusiUsiaBinned.series
        }],
        xaxis: {
            categories: distribusiUsiaBinned.labels,
            labels: {
                rotate: -45,
                trim: true
            }
        },
        yaxis: {
            title: {
                text: "Jumlah Responden"
            }
        },
        tooltip: {
            y: {
                formatter: function(val) {
                    return val + " responden";
                }
            }
        }
    }).render();

    // Bar: Median Upah per Gender
    new ApexCharts(document.querySelector("#chart-upah-gender"), {
        chart: {
            type: 'bar',
            height: 340
        },
        series: [{
            name: 'Median Upah',
            data: upahPerGender.map(r => r.median_upah)
        }],
        xaxis: {
            categories: upahPerGender.map(r => r.jenis_kelamin)
        },
        yaxis: {
            labels: {
                formatter: formatRupiah
            },
            title: {
                text: "Rp"
            }
        }
    }).render();

    // Bar: Median Upah per Pendidikan
    new ApexCharts(document.querySelector("#chart-upah-pendidikan"), {
        chart: {
            type: 'bar',
            height: 340
        },
        series: [{
            name: 'Median Upah',
            data: upahPerPendidikan.map(r => r.median_upah)
        }],
        xaxis: {
            categories: upahPerPendidikan.map(r => r.pendidikan)
        },
        yaxis: {
            labels: {
                formatter: formatRupiah
            },
            title: {
                text: "Rp"
            }
        }
    }).render();

    // Bar: Dosen vs Tendik
    new ApexCharts(document.querySelector("#chart-dosen-tendik"), {
        chart: {
            type: 'bar',
            height: 340
        },
        series: [{
            name: 'Median Upah',
            data: upahDosenTendik.map(r => r.median_upah)
        }],
        xaxis: {
            categories: upahDosenTendik.map(r => r.kategori)
        },
        yaxis: {
            labels: {
                formatter: formatRupiah
            },
            title: {
                text: "Rp"
            }
        }
    }).render();

    // Bar: Median Upah per Status Kepegawaian
    new ApexCharts(document.querySelector("#chart-upah-kepegawaian"), {
        chart: {
            type: 'bar',
            height: 340
        },
        series: [{
            name: 'Median Upah',
            data: upahPerKepegawaian.map(r => r.median_upah)
        }],
        xaxis: {
            categories: upahPerKepegawaian.map(r => r.status_kepegawaian)
        },
        yaxis: {
            labels: {
                formatter: formatRupiah
            },
            title: {
                text: "Rp"
            }
        }
    }).render();

    // Pie: Komposisi Gender
    new ApexCharts(document.querySelector("#chart-komposisi-gender"), {
        chart: {
            type: 'pie',
            height: 340
        },
        series: Object.values(statistikGender),
        labels: Object.keys(statistikGender),
        legend: {
            position: 'bottom'
        }
    }).render();

    // Pie: Komposisi Pendidikan
    new ApexCharts(document.querySelector("#chart-komposisi-pendidikan"), {
        chart: {
            type: 'pie',
            height: 340
        },
        series: Object.values(statistikPendidikan),
        labels: Object.keys(statistikPendidikan),
        legend: {
            position: 'bottom'
        }
    }).render();

    // Bar: Median Upah per Provinsi
    new ApexCharts(document.querySelector("#chart-median-provinsi"), {
        chart: {
            type: 'bar',
            height: 420
        },
        series: [{
            name: "Median Upah",
            data: perProvinsi.map(r => r.median_upah)
        }],
        xaxis: {
            categories: perProvinsi.map(r => r.provinsi),
            labels: {
                rotate: -60,
                trim: true
            }
        },
        yaxis: {
            labels: {
                formatter: formatRupiah
            },
            title: {
                text: "Rp"
            }
        }
    }).render();

    // Stacked Bar: Provinsi x Gender (Median)
    var provList = [...new Set(upahPerProvinsiGender.map(r => r.provinsi))];
    var genderList = [...new Set(upahPerProvinsiGender.map(r => r.jenis_kelamin))];
    var seriesProvGender = genderList.map(function(g) {
        return {
            name: g,
            data: provList.map(function(p) {
                var found = upahPerProvinsiGender.find(r => r.provinsi == p && r.jenis_kelamin == g);
                return found ? found.median_upah : 0;
            })
        };
    });
    new ApexCharts(document.querySelector("#chart-prov-gender"), {
        chart: {
            type: 'bar',
            height: 460,
            stacked: true
        },
        series: seriesProvGender,
        xaxis: {
            categories: provList,
            labels: {
                rotate: -60,
                trim: true
            }
        },
        yaxis: {
            labels: {
                formatter: formatRupiah
            },
            title: {
                text: "Rp"
            }
        },
        legend: {
            position: 'top'
        }
    }).render();

    // Histogram Lama Bekerja
    new ApexCharts(document.querySelector("#chart-distribusi-lama-bekerja"), {
        chart: {
            type: 'bar',
            height: 340
        },
        series: [{
            name: "Responden",
            data: distribusiLamaBekerjaBinned.series
        }],
        xaxis: {
            categories: distribusiLamaBekerjaBinned.labels,
            labels: {
                rotate: -45,
                trim: true
            }
        },
        yaxis: {
            title: {
                text: "Jumlah Responden"
            }
        },
        tooltip: {
            y: {
                formatter: function(val) {
                    return val + " responden";
                }
            }
        }
    }).render();

    new ApexCharts(document.querySelector("#chart-upah-jenis-pt"), {
        chart: {
            type: 'bar',
            height: 340
        },
        series: [{
            name: 'Median Upah',
            data: upahPerJenisPT.map(r => r.median_upah)
        }],
        xaxis: {
            categories: upahPerJenisPT.map(r => r.jenis_pt),
            labels: {
                rotate: -45,
                trim: true
            }
        },
        yaxis: {
            labels: {
                formatter: formatRupiah
            },
            title: {
                text: "Rp"
            }
        },
        tooltip: {
            y: {
                formatter: function(val) {
                    return "Rp" + val.toLocaleString('id-ID');
                }
            }
        }
    }).render();

    new ApexCharts(document.querySelector("#chart-upah-lama-bekerja"), {
        chart: {
            type: 'bar',
            height: 340
        },
        series: [{
            name: 'Median Upah',
            data: upahPerLamaBekerja.median
        }],
        xaxis: {
            categories: upahPerLamaBekerja.labels,
            labels: {
                rotate: -45,
                trim: true
            }
        },
        yaxis: {
            labels: {
                formatter: function(val) {
                    return "Rp" + val.toLocaleString('id-ID');
                }
            },
            title: {
                text: "Rp"
            }
        },
        tooltip: {
            y: {
                formatter: function(val, opts) {
                    var idx = opts.dataPointIndex;
                    var jumlah = upahPerLamaBekerja.jumlah[idx];
                    return "Rp" + val.toLocaleString('id-ID') + " (" + jumlah + " responden)";
                }
            }
        }

    }).render();
</script>


<!-- // highcharts -->

<script>
    document.addEventListener('DOMContentLoaded', function() {
        Highcharts.mapChart('peta-responden', {
            chart: {
                map: 'countries/id/id-all'
            },
            title: {
                text: null
            },
            legend: {
                enabled: true
            },
            colorAxis: {
                min: 0,
                minColor: '#F3F3F3',
                maxColor: '#1976D2'
            },
            series: [{
                data: <?= json_encode($peta_responden); ?>,
                joinBy: 'hc-key',
                name: 'Jumlah Responden',
                states: {
                    hover: {
                        color: '#FFC107'
                    }
                },
                dataLabels: {
                    enabled: false
                }
            }],
            tooltip: {
                pointFormat: '{point.name}: <b>{point.value}</b> responden'
            }
        });
    });
</script>





</body>

</html>